{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/main/.schema/devbox.schema.json",
  "packages": ["go@1.24"],
  "env": {
    "GOOS": "js",
    "GOARCH": "wasm"
  },
  "shell": {
    "init_hook": ["go mod download"],
    "scripts": {
      "bump": ["cz --no-raise 6,21 bump --yes --increment PATCH"],
      "release": [
        "devbox run wasm",
        "wrangler r2 object put cdn/vault.wasm -f dist/vault.wasm --remote"
      ],
      "publish": "gum style --foreground 214 '‚ö†Ô∏è  Skipping publish - unimplemented'",
      "wasm": [
        "mkdir -p dist",
        "export GOROOT=$(readlink -f $(which go) | sed 's|/bin/go||' | sed 's|/share/go||')/share/go",
        "go mod tidy",
        "go build -ldflags='-s -w' -trimpath -o dist/vault.wasm .",
        "rm -f dist/wasm_exec.js",
        "cp \"$GOROOT/lib/wasm/wasm_exec.js\" dist/",
        "chmod 644 dist/wasm_exec.js"
      ],
      "test": "go test ./... || gum style --foreground 245 'üìù No Go tests found in vault'",
      "format": "go fmt ./... || gum style --foreground 46 '‚úì No Go formatting issues found in vault'"
    }
  }
}
