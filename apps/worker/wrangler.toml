#:schema node_modules/wrangler/config-schema.json
name = "motr-worker"
main = "src/worker.ts"
compatibility_date = "2025-01-11"
compatibility_flags = ["nodejs_compat"]

# Production environment
[env.production]
name = "motr-worker"
workers_dev = false

[env.production.vars]
ENVIRONMENT = "production"

# Staging environment
[env.staging]
name = "motr-worker-staging"
workers_dev = true

[env.staging.vars]
ENVIRONMENT = "staging"

# Development configuration
[dev]
port = 8787
local_protocol = "http"
ip = "0.0.0.0"

# Service binding to the Enclave Worker
# The Enclave Worker hosts the SonrIdentityDurable Durable Object
[[services]]
binding = "ENCLAVE"
service = "motr-enclave"

# Service binding to the Vault Worker
# The Vault Worker handles transaction signing and broadcasting
[[services]]
binding = "VAULT"
service = "motr-vault"

# KV namespace for session management
[[kv_namespaces]]
binding = "SESSIONS"
id = "TBD_SESSIONS_ID"
preview_id = "TBD_SESSIONS_PREVIEW_ID"

# KV namespace for OTP storage (shared)
[[kv_namespaces]]
binding = "OTP_STORE"
id = "0943b06e4f5b46799d4c16b794d62279"
preview_id = "cf5b397898a34b01a62fd92aa82f18a6"

# KV namespace for Chain Registry (shared)
[[kv_namespaces]]
binding = "CHAIN_REGISTRY"
id = "6cd19a6b02294ad6b6b3e8d1341ccfa2"
preview_id = "360aa630a9184acf8e1e70d77c230849"

# KV namespace for Asset Registry (shared)
[[kv_namespaces]]
binding = "ASSET_REGISTRY"
id = "cd3daa64727b409c81c41472cd688ab2"
preview_id = "cd3daa64727b409c81c41472cd688ab2"

# Environment variables
[vars]
EMAIL_FROM = "Sonr Identity <noreply@sonr.id>"

# Observability
[observability]
enabled = true
head_sampling_rate = 1.0
